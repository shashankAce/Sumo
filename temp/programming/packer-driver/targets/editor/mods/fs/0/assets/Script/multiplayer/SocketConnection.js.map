{"version":3,"sources":["file:///D:/Office/Sumo/assets/Script/multiplayer/SocketConnection.ts"],"names":["_decorator","Component","Client","Constants","MiloManager","ccclass","property","SocketConnection","connect","domain","window","location","href","split","url","client","miloManager","userInfo","JSON","parse","onGameInit","playerInfo","players","find","obj","userId","initInfo","playerName","name","Object","assign","micEnable","micEnabled","loginDetails","isHost","host","gameConfig","roomName","create","roomType","roomId","then","room","isConnected","onConnect","console","log","catch","e"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;AACSA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;;AACZC,MAAAA,M,eAAAA,M;;AAEAC,MAAAA,S,iBAAAA,S;;AACAC,MAAAA,W,iBAAAA,W;;;;;;;OAEH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBN,U;;kCAGjBO,gB,WADZF,OAAO,CAAC,kBAAD,C,yBAAR,MACaE,gBADb,SACsCN,SADtC,CACgD;AAAA;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;AAAA;;AAO5CO,QAAAA,OAAO,GAAG;AACN,cAAIC,MAAM,GAAGC,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBC,KAArB,CAA2B,GAA3B,EAAgC,CAAhC,CAAb;AACA,cAAIC,GAAG,GAAG,UAAUL,MAAM,CAACI,KAAP,CAAa,GAAb,EAAkB,CAAlB,CAAV,GAAiC,OAA3C;AAEA,eAAKE,MAAL,GAAc;AAAA;AAAA,gCAAWD,GAAX,CAAd;AAEA,cAAIE,WAAW,GAAG;AAAA;AAAA,2CAAlB;AAEA,cAAIC,QAAQ,GAAGC,IAAI,CAACC,KAAL,CAAWH,WAAW,CAACI,UAAZ,EAAX,CAAf;AACA,cAAIC,UAAU,GAAGJ,QAAQ,CAACK,OAAT,CAAiBC,IAAjB,CAAuBC,GAAD,IAAS;AAC5C,mBAAOA,GAAG,CAACC,MAAJ,IAAcR,QAAQ,CAACS,QAAT,CAAkBD,MAAvC;AACH,WAFgB,CAAjB;AAGA,eAAKE,UAAL,GAAkBN,UAAU,CAACO,IAA7B;AAEAP,UAAAA,UAAU,GAAGQ,MAAM,CAACC,MAAP,CAAcT,UAAd,EAA0B;AACnCU,YAAAA,SAAS,EAAEd,QAAQ,CAACS,QAAT,CAAkBM;AADM,WAA1B,CAAb;AAIA,cAAIC,YAAY,GAAGJ,MAAM,CAACC,MAAP,CAAcb,QAAQ,CAACS,QAAvB,EAAiC;AAChDQ,YAAAA,MAAM,EAAEb,UAAU,CAACc,IAD6B;AAEhDd,YAAAA,UAAU,EAAEA,UAFoC;AAGhDe,YAAAA,UAAU;AAAA;AAAA,sCAHsC;AAIhDC,YAAAA,QAAQ,EAAE;AAJsC,WAAjC,CAAnB;AAQA,eAAKtB,MAAL,CAAYuB,MAAZ,CAAmBL,YAAY,CAACI,QAAhC,EAA0C;AACtCE,YAAAA,QAAQ,EAAE,SAD4B;AAEtCC,YAAAA,MAAM,EAAEP,YAAY,CAACO,MAFiB;AAGtCnB,YAAAA,UAAU,EAAEY,YAAY,CAACZ,UAHa;AAItCe,YAAAA,UAAU,EAAEH,YAAY,CAACG;AAJa,WAA1C,EAMGK,IANH,CAMQC,IAAI,IAAI;AAEZ,iBAAKC,WAAL,GAAmB,IAAnB;AACA,iBAAKC,SAAL,CAAeF,IAAf;AAEAG,YAAAA,OAAO,CAACC,GAAR,CAAY,2BAAZ,EAAyCJ,IAAzC;AAGH,WAdD,EAcGK,KAdH,CAcUC,CAAD,IAAO;AACZH,YAAAA,OAAO,CAACC,GAAR,CAAYE,CAAZ;AACH,WAhBD;AAiBH;;AAEDJ,QAAAA,SAAS,CAACF,IAAD,EAAa;AAClB,eAAKA,IAAL,GAAYA,IAAZ;AAGH;;AAxD2C,O","sourcesContent":["\nimport { _decorator, Component, Node } from 'cc';\nimport { Client, Room } from 'colyseus.js';\n\nimport { Constants } from './Config';\nimport { MiloManager } from './MiloManager';\n\nconst { ccclass, property } = _decorator;\n\n@ccclass('SocketConnection')\nexport class SocketConnection extends Component {\n\n    client: Client;\n    playerName: string;\n    isConnected: boolean;\n    room: Room;\n\n    connect() {\n        let domain = window.location.href.split('/')[2];\n        let url = \"ws://\" + domain.split(':')[0] + ':2567';\n\n        this.client = new Client(url);\n\n        let miloManager = MiloManager();\n\n        let userInfo = JSON.parse(miloManager.onGameInit());\n        let playerInfo = userInfo.players.find((obj) => {\n            return obj.userId == userInfo.initInfo.userId\n        });\n        this.playerName = playerInfo.name;\n\n        playerInfo = Object.assign(playerInfo, {\n            micEnable: userInfo.initInfo.micEnabled\n        });\n\n        let loginDetails = Object.assign(userInfo.initInfo, {\n            isHost: playerInfo.host,\n            playerInfo: playerInfo,\n            gameConfig: Constants,\n            roomName: 'OriginalWar'\n        });\n\n\n        this.client.create(loginDetails.roomName, {\n            roomType: 'private',\n            roomId: loginDetails.roomId,\n            playerInfo: loginDetails.playerInfo,\n            gameConfig: loginDetails.gameConfig\n\n        }).then(room => {\n\n            this.isConnected = true;\n            this.onConnect(room);\n\n            console.log(\"Room Created Successfully\", room);\n\n\n        }).catch((e) => {\n            console.log(e);\n        });\n    }\n\n    onConnect(room: Room) {\n        this.room = room;\n\n\n    }\n}\n"]}